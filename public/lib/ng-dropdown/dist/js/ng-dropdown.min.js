"use strict";!function(e){e.module("ng-dropdown",[]).service("DropdownService",["$document",function(e){var n=this;this.dropdowns=[],this.open=function(e){var n=this,t=this.dropdowns[e];t.opened||((this.currentlyOpen||0===this.currentlyOpen)&&this.close(this.currentlyOpen),t.element.addClass(t.activeClass),t.menuElement.addClass(t.openClass),t.opened=!0,setTimeout(function(){return n.currentlyOpen=e},0))},this.close=function(e){var n=this.dropdowns[e];n.opened&&(n.element.removeClass(n.activeClass),n.menuElement.removeClass(n.openClass),n.opened=!1,delete this.currentlyOpen)},this.toggle=function(e){var n=this.dropdowns[e];n.opened?this.close(e):this.open(e)},e.bind("click",function(e){if(n.currentlyOpen||0===n.currentlyOpen){var t=n.dropdowns[n.currentlyOpen];t.menuElement!==e.target&&n.close(n.currentlyOpen)}})}]).directive("dropdown",["$document","$parse","DropdownService",function(n,t,o){return{restrict:"A",scope:{dropdown:"=?",disabled:"&dropdownDisabled",preventOnClick:"=dropdownPreventOnClick"},link:function(t,d,r){function i(){return Array.prototype.map.call(o.menuElement.children(),function(e){return e})}function l(){t.currentOption&&(e.element(t.currentOption).removeClass(f),delete t.currentOption)}function c(){if(o.open(u.id),p){var n=p.indexOf(t.currentOption)+1;l(),t.currentOption=p.length>n?p[n]:p[0]}else p=i(),t.currentOption=p[0];e.element(t.currentOption).addClass(f),o.menuElement[0].scrollTop=t.currentOption.offsetTop}function s(){if(o.open(u.id),p){var n=p.indexOf(t.currentOption)-1;l(),t.currentOption=n>=0?p[n]:p[p.length-1]}else p=i(),t.currentOption=p[0];e.element(t.currentOption).addClass(f),o.menuElement[0].scrollTop=t.currentOption.offsetTop}var p,u,a=d[0].querySelector(".ng-dropdown-field"),m=r.dropdownOpenClass||"open",f=r.dropdownActiveClass||"active";u={id:o.dropdowns.length,activeClass:f,openClass:m,element:d,menuElement:e.element(document.getElementById(r.dropdownMenu))},t.dropdown=o.dropdowns[u.id]=u,t.$watch("disabled()",function(e){e?d.addClass("dropdown-disabled"):d.removeClass("dropdown-disabled")}),e.element(document.getElementById(r.dropdownMenu)).bind("mouseenter",function(){l()}),d.bind("click",function(n){if(!t.preventOnClick&&!t.disabled()){var i=e.element(document.getElementById(r.dropdownMenu));o.menuElement&&o.menuElement.attr("id")!==i.attr("id")&&o.close(u.id),o.menuElement=i,o.element=d,n.preventDefault(),n.stopPropagation(),o.toggle(u.id)}}),n.bind("keydown",function(n){if(!t.disabled()&&(u.opened||document.activeElement===a)&&-1!==[9,27,40,38,13].indexOf(n.keyCode)){if(o.element=d,o.menuElement=e.element(document.getElementById(r.dropdownMenu)),9===n.keyCode)return void o.close(u.id);n.preventDefault(),n.stopPropagation(),27===n.keyCode?o.close(u.id):40===n.keyCode?c():38===n.keyCode?s():13===n.keyCode&&(t.currentOption&&u.opened&&document.activeElement===a?t.currentOption.click():u.opened||document.activeElement!==a||o.open(u.id))}})}}}])}(window.angular);