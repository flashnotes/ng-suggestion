"use strict";!function(e){e.module("ng-suggestion",["ng-dropdown"]).service("SuggestionService",["DropdownService",function(e){this.inputs=[],this.deleteHandlers={},this.responseHandler=function(n){return function(r){n.loading=!1,n.oldParams=n.params,r?(e.open(n.dropdown.id),n.responseProperty&&r[n.responseProperty]&&Array.isArray(r[n.responseProperty])&&r[n.responseProperty].length>0?n.options=r[n.responseProperty]:Array.isArray(r)&&r.length>0?n.options=r:n.options=!1):n.options=!1}},this.keyUpHandler=function(n){var r=this;return function(o){(8===o.keyCode||46===o.keyCode)&&r.deleteHandlers[n.id]&&r.deleteHandlers[n.id](o),27===o.keyCode?n.element[0].blur():n.model?n.oldParams!==n.params&&-1===[9,27,40,38,13].indexOf(o.keyCode)&&(n.loading=!0,n.responseProperty?n.resource.get(n.params,r.responseHandler(n)):n.resource.query(n.params,r.responseHandler(n))):e.close(n.dropdown.id)}},this.keydownHandler=function(e){return function(n){var r=e.dropdown.currentOption,o=e.freeText,s=e.enterAction;if(13===n.keyCode&&(r&&!o||o)&&(e.dropdown.disableClick=!1,s)){var t=s();t(e.model)}}},this.focusHandler=function(n){return function(){n.dropdown.disableClick=!0,n.model&&e.open(n.dropdown.id)}},this.blurHandler=function(n){return function(){n.dropdown.isInsideMenu?n.dropdown.disableClick=!1:e.close(n.dropdown.id)}}}]).directive("suggestion",["$resource","SuggestionService",function(e,n){return{restrict:"A",scope:{suggestion:"=?",model:"=suggestionModel",url:"=suggestionUrl",params:"=suggestionParams",dropdown:"=suggestionDropdown",freeText:"=suggestionFreeText",enterAction:"&suggestionEnterAction",responseProperty:"@?suggestionResponseProperty"},link:function(r,o){var s={id:n.inputs.length,element:o,resource:e(r.url),freeText:r.freeText,enterAction:r.enterAction,responseProperty:r.responseProperty};r.suggestion=n.inputs[s.id]=s;var t=r.$watch("dropdown",function(e){e.disableDocumentClick=!0,s.dropdown=e,t()});r.$watch("params",function(e){s.params=e}),r.$watch("model",function(e){s.model=e}),o.bind("keyup paste",n.keyUpHandler(s)),o.bind("keydown",n.keydownHandler(s)),o.bind("focus",n.focusHandler(s)),o.bind("blur",n.blurHandler(s))}}}])}(window.angular);