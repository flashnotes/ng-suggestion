"use strict";!function(e){e.module("ng-suggestion",["ng-dropdown"]).service("SuggestionService",["DropdownService",function(e){this.inputs=[],this.deleteHandlers={},this.responseHandler=function(n){return function(o){n.loading=!1,n.oldParams=n.params,o?(e.open(n.dropdown.id),n.responseProperty&&o[n.responseProperty]&&Array.isArray(o[n.responseProperty])&&o[n.responseProperty].length>0?n.options=o[n.responseProperty]:Array.isArray(o)&&o.length>0?n.options=o:n.options=!1):n.options=!1}},this.keyUpHandler=function(n){var o=this;return function(r){(8===r.keyCode||46===r.keyCode)&&o.deleteHandlers[n.id]&&o.deleteHandlers[n.id](r),27===r.keyCode?n.element[0].blur():n.model?n.oldParams!==n.params&&-1===[9,27,40,38,13].indexOf(r.keyCode)&&(n.loading=!0,n.responseProperty?n.resource.get(n.params,o.responseHandler(n)):n.resource.query(n.params,o.responseHandler(n))):e.close(n.dropdown.id)}},this.keydownHandler=function(e){return function(n){var o=e.dropdown.currentOption;o&&13===n.keyCode&&(e.dropdown.disableClick=!1)}},this.focusHandler=function(n){return function(){n.dropdown.disableClick=!0,n.model&&e.open(n.dropdown.id)}},this.blurHandler=function(n){return function(){n.dropdown.isInsideMenu?n.dropdown.disableClick=!1:e.close(n.dropdown.id)}}}]).directive("suggestion",["$resource","SuggestionService",function(e,n){return{restrict:"A",scope:{suggestion:"=?",model:"=suggestionModel",url:"=suggestionUrl",params:"=suggestionParams",dropdown:"=suggestionDropdown",responseProperty:"@?suggestionResponseProperty"},link:function(o,r){var s={id:n.inputs.length,element:r,resource:e(o.url),responseProperty:o.responseProperty};o.suggestion=n.inputs[s.id]=s;var d=o.$watch("dropdown",function(e){e.disableDocumentClick=!0,s.dropdown=e,d()});o.$watch("params",function(e){s.params=e}),o.$watch("model",function(e){s.model=e}),r.bind("keyup paste",n.keyUpHandler(s)),r.bind("keydown",n.keydownHandler(s)),r.bind("focus",n.focusHandler(s)),r.bind("blur",n.blurHandler(s))}}}])}(window.angular);